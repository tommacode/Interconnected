<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manage Groups | Interconnected</title>
    <%- include('Partials/Head.html') %>
  </head>
  <body onload="LoadAccounts()">
    <%- include('Partials/Navigation.html') %>
    <main>
      <h3>Manage Groups</h3>
      <div>
        <form action="api/Admin/CreateGroup" method="post" id="CreateGroup">
          <input
            type="text"
            name="GroupName"
            id="GroupName"
            placeholder="Group Name"
          />
          <input type="submit" value="Create"></input>
        </form>
      </div>
      <div id="GroupWrapper"></div>
    </main>
    <script>
      let Children = [];
      function LoadAccounts() {
        fetch("/api/Admin/Accounts", {
          method: "GET",
        })
          .then((res) => res.json())
          .then((data) => {
            for (i = 0; i < data.length; i++) {
              Children.push(data[i].Firstname + " " + data[i].Surname);
            }
          });

        fetch("/api/Admin/Groups", {
          method: "GET",
        })
          .then((res) => res.json())
          .then((data) => {
            let GroupWrapper = document.getElementById("GroupWrapper");
            data.forEach((group) => {
              let Group = document.createElement("div");
              Group.classList.add("Group");
              Group.innerHTML = `
                    <form action="/api/Admin/DeleteGroup" method="post">
                    <input type="hidden" name="GroupID" value="${
                      group.GroupID
                    }" />
                    <button type="submit" class="DeleteGroup"><?xml version="1.0" encoding="utf-8"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
      <svg viewBox="0 0 24 24" fill="none" class="NavIcons" xmlns="http://www.w3.org/2000/svg">
      <path d="M14.5 9.50002L9.5 14.5M9.49998 9.5L14.5 14.5" stroke="#000000" stroke-width="1.5" stroke-linecap="round"/>
      <path d="M7 3.33782C8.47087 2.48697 10.1786 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 10.1786 2.48697 8.47087 3.33782 7" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round"/>
      </svg></button>
                  </form>
                  <h4>${group.Name} (${group.Members.length} Members)</h4>
                  <hr>
                  <button class="GroupInfo"><?xml version="1.0" encoding="utf-8"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
      <svg class="NavIcons" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M10 21L22 21M2 21L6 21" stroke="#000000" stroke-width="1.5" stroke-linecap="round"/>
      <path d="M5 9L5 14.5C5 15.4346 5 15.9019 5.20096 16.25C5.33261 16.478 5.52197 16.6674 5.75 16.799C6.09808 17 6.56538 17 7.5 17C8.43462 17 8.90192 17 9.25 16.799C9.47803 16.6674 9.66739 16.478 9.79904 16.25C10 15.9019 10 15.4346 10 14.5L10 5.5C10 4.56538 10 4.09808 9.79904 3.75C9.66739 3.52197 9.47803 3.33261 9.25 3.20096C8.90192 3 8.43462 3 7.5 3C6.56538 3 6.09808 3 5.75 3.20096C5.52197 3.33261 5.33261 3.52197 5.20096 3.75C5.03954 4.0296 5.00778 4.38613 5.00153 5" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round"/>
      <path d="M16.5 17C15.5654 17 15.0981 17 14.75 16.799C14.522 16.6674 14.3326 16.478 14.201 16.25C14 15.9019 14 15.4346 14 14.5L14 8.5C14 7.56538 14 7.09808 14.201 6.75C14.3326 6.52197 14.522 6.33261 14.75 6.20096C15.0981 6 15.5654 6 16.5 6C17.4346 6 17.9019 6 18.25 6.20096C18.478 6.33261 18.6674 6.52197 18.799 6.75C19 7.09808 19 7.56538 19 8.5L19 14.5C19 15.4346 19 15.9019 18.799 16.25C18.6674 16.478 18.478 16.6674 18.25 16.799C17.9019 17 17.4346 17 16.5 17Z" stroke="#1C274C" stroke-width="1.5"/>
      </svg></button>
                  <form action="/api/Admin/AddUserToGroup" method="post" class="AddUser">
                    <input type="hidden" name="GroupID" value="${
                      group.UniqueID
                    }" />
                    <select name="Name">
                      ${Children.map((child) => {
                        if (group.Members.includes(child)) return "";
                        else
                          return `<option value="${child}">${child}</option>`;
                      })}
                    </select>
                    <input type="submit" value="Add" />
                  </form>
                  `;
              GroupWrapper.appendChild(Group);
            });
          });
      }
    </script>
  </body>
</html>
